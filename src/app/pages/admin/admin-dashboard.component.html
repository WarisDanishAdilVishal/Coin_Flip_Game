<div class="min-h-screen text-white flex flex-col bg-black relative">
    <div class="absolute inset-0 bg-gradient-to-b from-[#ff0080]/20 via-[#40e0d0]/20 to-[#ff8c00]/20 pointer-events-none bg-gradient-animate"></div>
    
    <app-header [showBalance]="false"></app-header>
    
    <div class="flex-1 flex flex-col md:flex-row py-2 sm:py-4 relative overflow-x-hidden">
      <!-- Left Sidebar -->
      <div class="w-full md:w-64 lg:w-72 flex-shrink-0 px-2 sm:px-4 mb-4 md:mb-0">
        <div class="top-2">
          <div class="bg-black/50 backdrop-blur-lg rounded-xl p-4 border border-pink-500/30 shadow-neon mb-4">
            <div>
              <button 
                (click)="navigateBack()" 
                class="flex items-center gap-3 p-3 rounded-lg bg-black/30 text-red-400 hover:bg-red-500/20 transition-all"
              >
                <lucide-icon name="arrow-left" [size]="18"></lucide-icon>
              </button>
            </div>
            <div class="flex flex-col items-center mb-6">
              <div class="w-20 h-20 rounded-full bg-gradient-to-r from-red-500 to-purple-500 flex items-center justify-center mb-4">
                <lucide-icon name="user" [size]="32" class="text-white"></lucide-icon>
              </div>
              <h2 class="text-xl font-bold text-white mb-1">Admin Dashboard</h2>
              <p class="text-pink-300 text-sm">Logged in as {{ username }}</p>
            </div>
            
            <div class="space-y-2">
              <a 
                (click)="setActiveSection('stats')"
                class="flex items-center gap-3 p-3 rounded-lg cursor-pointer"
                [ngClass]="activeSection === 'stats' ? 'bg-gradient-to-r from-pink-500/30 to-purple-500/30 text-white' : 'bg-black/30 text-white/70 hover:bg-black/50 hover:text-white'"
              >
                <lucide-icon name="bar-chart" [size]="18"></lucide-icon>
                <span>Game Statistics</span>
              </a>
              <a 
                (click)="setActiveSection('transactions')"
                class="flex items-center gap-3 p-3 rounded-lg cursor-pointer"
                [ngClass]="activeSection === 'transactions' ? 'bg-gradient-to-r from-pink-500/30 to-purple-500/30 text-white' : 'bg-black/30 text-white/70 hover:bg-black/50 hover:text-white'"
              >
                <lucide-icon name="dollar-sign" [size]="18"></lucide-icon>
                <span>Transactions</span>
              </a>
              <a 
                (click)="setActiveSection('withdrawals')"
                class="flex items-center gap-3 p-3 rounded-lg cursor-pointer"
                [ngClass]="activeSection === 'withdrawals' ? 'bg-gradient-to-r from-pink-500/30 to-purple-500/30 text-white' : 'bg-black/30 text-white/70 hover:bg-black/50 hover:text-white'"
              >
                <lucide-icon name="credit-card" [size]="18"></lucide-icon>
                <span>Withdrawal Requests</span>
              </a>
              <a 
                (click)="setActiveSection('users')"
                class="flex items-center gap-3 p-3 rounded-lg cursor-pointer"
                [ngClass]="activeSection === 'users' ? 'bg-gradient-to-r from-pink-500/30 to-purple-500/30 text-white' : 'bg-black/30 text-white/70 hover:bg-black/50 hover:text-white'"
              >
                <lucide-icon name="users" [size]="18"></lucide-icon>
                <span>User Management</span>
              </a>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Main Content -->
      <div class="flex-1 px-2 sm:px-4">
        <div class="max-w-4xl">
          <!-- Global Loading State -->
          <div *ngIf="isLoading" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
          </div>

          <!-- Global Error Message -->
          <div *ngIf="error" class="mb-4 bg-red-500/20 border border-red-500/30 rounded-lg p-4 text-red-300">
            {{ error }}
          </div>

          <!-- Game Statistics Section -->
          <section *ngIf="activeSection === 'stats'" class="mb-8">
            <h2 class="text-2xl font-bold mb-6">Game Statistics</h2>
            
            <!-- Statistics Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
              <div class="bg-gray-800/50 rounded-lg p-4 border border-gray-700/50">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-gray-400">Total Games</p>
                    <p class="text-2xl font-bold">{{ totalGames }}</p>
                  </div>
                  <div class="p-2 bg-blue-500/20 rounded-lg">
                    <lucide-icon name="bar-chart" [size]="24" class="text-blue-500"></lucide-icon>
                  </div>
                </div>
              </div>
              
              <div class="bg-gray-800/50 rounded-lg p-4 border border-gray-700/50">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-gray-400">Total Wagered</p>
                    <p class="text-2xl font-bold">₹{{ totalWagered.toLocaleString() }}</p>
                  </div>
                  <div class="p-2 bg-green-500/20 rounded-lg">
                    <lucide-icon name="dollar-sign" [size]="24" class="text-green-500"></lucide-icon>
                  </div>
                </div>
              </div>
              
              <div class="bg-gray-800/50 rounded-lg p-4 border border-gray-700/50">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-gray-400">Total Won</p>
                    <p class="text-2xl font-bold">₹{{ totalWon.toLocaleString() }}</p>
                  </div>
                  <div class="p-2 bg-yellow-500/20 rounded-lg">
                    <lucide-icon name="credit-card" [size]="24" class="text-yellow-500"></lucide-icon>
                  </div>
                </div>
              </div>
              
              <div class="bg-gray-800/50 rounded-lg p-4 border border-gray-700/50">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-gray-400">Total Profit</p>
                    <p class="text-2xl font-bold" [ngClass]="{'text-green-500': totalProfit >= 0, 'text-red-500': totalProfit < 0}">
                      {{ totalProfit >= 0 ? '+' : '' }}₹{{ Math.abs(totalProfit).toLocaleString() }}
                    </p>
                  </div>
                  <div class="p-2" [ngClass]="{'bg-green-500/20': totalProfit >= 0, 'bg-red-500/20': totalProfit < 0}">
                    <lucide-icon name="arrow-left" [size]="24" [ngClass]="{'text-green-500': totalProfit >= 0, 'text-red-500': totalProfit < 0}"></lucide-icon>
                  </div>
                </div>
              </div>
            </div>
          </section>
          
          <!-- Transactions Section -->
          <section *ngIf="activeSection === 'transactions'" class="mb-8">
            <div class="bg-black/50 backdrop-blur-lg rounded-xl p-6 border border-blue-500/30 shadow-neon-blue">
              <h2 class="text-xl font-bold mb-6 flex items-center gap-2 text-blue-300">
                <lucide-icon name="dollar-sign" [size]="20"></lucide-icon>
                Transaction History
              </h2>
              
              <!-- Search and Filter -->
              <div class="flex flex-col sm:flex-row gap-4 mb-6">
                <div class="relative flex-1">
                  <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <lucide-icon name="search" [size]="18" class="text-blue-500/50"></lucide-icon>
                  </div>
                  <input 
                    type="text" 
                    [(ngModel)]="transactionSearch"
                    (input)="filterTransactions()"
                    class="w-full bg-black/50 border border-blue-500/30 rounded-md p-2 pl-10 text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50"
                    placeholder="Search by username or transaction ID"
                  />
                </div>
                <select 
                  [(ngModel)]="transactionTypeFilter"
                  (change)="filterTransactions()"
                  class="bg-black/50 border border-blue-500/30 rounded-md p-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50"
                >
                  <option value="all">All Types</option>
                  <option value="deposit">Deposits</option>
                  <option value="withdrawal">Withdrawals</option>
                  <option value="game">Game Transactions</option>
                </select>
              </div>
              
              <!-- Transactions Table -->
              <div class="overflow-x-auto -mx-4 sm:mx-0">
                <div class="min-w-[700px] px-4 sm:px-0">
                  <!-- Loading State -->
                  <div *ngIf="isLoadingTransactions" class="flex justify-center items-center py-8">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
                  </div>
                  
                  <!-- Transactions Table -->
                  <table class="w-full" *ngIf="!isLoadingTransactions">
                    <thead>
                      <tr class="text-blue-300 text-sm">
                        <th class="text-left pb-4">Date & Time</th>
                        <th class="text-left pb-4">User</th>
                        <th class="text-left pb-4">Type</th>
                        <th class="text-left pb-4">Amount</th>
                        <th class="text-left pb-4">Status</th>
                        <th class="text-left pb-4">Details</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr 
                        *ngFor="let txn of paginatedTransactions" 
                        class="border-t border-blue-500/10"
                      >
                        <td class="py-4">{{ formatDateTime(txn.timestamp) }}</td>
                        <td>{{ txn.username }}</td>
                        <td>
                          <span class="px-2 py-1 rounded-full text-xs font-medium"
                                [ngClass]="{
                                  'bg-green-500/20 text-green-400': txn.type === 'deposit',
                                  'bg-red-500/20 text-red-400': txn.type === 'withdrawal',
                                  'bg-blue-500/20 text-blue-400': txn.type === 'game'
                                }">
                            {{ formatTransactionType(txn.type) }}
                          </span>
                        </td>
                        <td [ngClass]="txn.amount >= 0 ? 'text-green-400' : 'text-red-400'">
                          {{ txn.amount >= 0 ? '+' : '-' }}₹{{ Math.abs(txn.amount).toLocaleString() }}
                        </td>
                        <td>
                          <span class="px-2 py-1 rounded-full text-xs font-medium"
                                [ngClass]="{
                                  'bg-green-500/20 text-green-400': txn.status === 'completed',
                                  'bg-yellow-500/20 text-yellow-400': txn.status === 'pending',
                                  'bg-red-500/20 text-red-400': txn.status === 'failed'
                                }">
                            {{ formatStatus(txn.status) }}
                          </span>
                        </td>
                        <td class="text-white/70">{{ txn.details || '-' }}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              
              <!-- Pagination Controls -->
              <div *ngIf="!isLoadingTransactions && transactions.length > 0" class="mt-6 flex items-center justify-between">
                <div class="text-sm text-blue-300">
                  Showing {{ paginatedTransactions.length > 0 ? (pageSize * (currentPage - 1) + 1) : 0 }}-{{ paginatedTransactions.length > 0 ? Math.min(pageSize * currentPage, filteredTransactions.length) : 0 }} of {{ filteredTransactions.length }} transactions
                </div>
                <div class="flex items-center gap-4">
                  <button 
                    (click)="goToPreviousPage()"
                    [disabled]="currentPage <= 1"
                    class="px-3 py-1 rounded-md bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 disabled:opacity-50 disabled:cursor-not-allowed"
                  >
                    Previous
                  </button>
                  <span class="text-blue-300">Page {{ currentPage }} of {{ totalPages }}</span>
                  <button 
                    (click)="goToNextPage()"
                    [disabled]="currentPage >= totalPages"
                    class="px-3 py-1 rounded-md bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 disabled:opacity-50 disabled:cursor-not-allowed"
                  >
                    Next
                  </button>
                </div>
              </div>
              
              <!-- No Results Message -->
              <div *ngIf="!isLoadingTransactions && transactions.length === 0" class="text-center py-8 text-blue-300">
                No transactions found
              </div>
            </div>
          </section>
          
          <!-- Withdrawal Requests Section -->
          <section *ngIf="activeSection === 'withdrawals'" class="mb-8">
            <div class="bg-black/50 backdrop-blur-lg rounded-xl p-6 border border-yellow-500/30 shadow-neon-yellow">
              <h2 class="text-xl font-bold mb-6 flex items-center gap-2 text-yellow-300">
                <lucide-icon name="credit-card" [size]="20"></lucide-icon>
                Withdrawal Requests
              </h2>
              
              <!-- Filter -->
              <div class="flex flex-col sm:flex-row gap-4 mb-6">
                <select 
                  [(ngModel)]="withdrawalStatusFilter"
                  (change)="filterWithdrawals()"
                  class="bg-black/50 border border-yellow-500/30 rounded-md p-2 text-white focus:outline-none focus:ring-2 focus:ring-yellow-500/50"
                >
                  <option value="all">All Statuses</option>
                  <option value="pending">Pending</option>
                  <option value="approved">Approved</option>
                  <option value="rejected">Rejected</option>
                </select>
              </div>
              
              <!-- Pending Withdrawals -->
              <div *ngIf="pendingWithdrawals.length > 0" class="mb-8">
                <h3 class="text-lg font-medium text-yellow-300 mb-4">Pending Approval</h3>
                
                <div class="space-y-4">
                  <div *ngFor="let withdrawal of pendingWithdrawals" class="bg-black/30 rounded-lg p-4 border border-yellow-500/10">
                    <div class="flex flex-col sm:flex-row justify-between gap-4">
                      <div>
                        <div class="flex items-center gap-2 mb-2">
                          <span class="font-medium text-white">{{ withdrawal.username }}</span>
                          <span class="px-2 py-0.5 rounded-full text-xs font-medium bg-yellow-500/20 text-yellow-400">
                            Pending
                          </span>
                        </div>
                        <p class="text-lg font-bold text-white mb-1">₹{{ withdrawal.amount.toLocaleString() }}</p>
                        <p class="text-sm text-white/70">
                          {{ formatDateTime(withdrawal.timestamp) }} via {{ formatPaymentMethod(withdrawal.method) }}
                        </p>
                        <p class="text-sm text-white/70 mt-1">
                          <span class="text-yellow-300">Details:</span> {{ withdrawal.details }}
                        </p>
                      </div>
                      <div class="flex gap-2 sm:self-center">
                        <app-button
                          (onClick)="approveWithdrawal(withdrawal.id)"
                          className="bg-green-500/20 hover:bg-green-500/30 text-green-300 border border-green-400/30"
                          fontSize="0.75rem"
                          padding="0.375rem 0.75rem"
                        >
                          <lucide-icon name="check-circle" [size]="14" class="mr-1"></lucide-icon> Approve
                        </app-button>
                        <app-button
                          (onClick)="rejectWithdrawal(withdrawal.id)"
                          className="bg-red-500/20 hover:bg-red-500/30 text-red-300 border border-red-400/30"
                          fontSize="0.75rem"
                          padding="0.375rem 0.75rem"
                        >
                          <lucide-icon name="x-circle" [size]="14" class="mr-1"></lucide-icon> Reject
                        </app-button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- All Withdrawals Table -->
              <div class="overflow-x-auto -mx-4 sm:mx-0">
                <div class="min-w-[700px] px-4 sm:px-0">
                  <table class="w-full">
                    <thead>
                      <tr class="text-yellow-300 text-sm">
                        <th class="text-left pb-4">Date & Time</th>
                        <th class="text-left pb-4">User</th>
                        <th class="text-left pb-4">Amount</th>
                        <th class="text-left pb-4">Method</th>
                        <th class="text-left pb-4">Status</th>
                        <th class="text-left pb-4">Details</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr 
                        *ngFor="let withdrawal of filteredWithdrawals" 
                        class="border-t border-yellow-500/10"
                      >
                        <td class="py-4">{{ formatDateTime(withdrawal.timestamp) }}</td>
                        <td>{{ withdrawal.username }}</td>
                        <td>₹{{ withdrawal.amount.toLocaleString() }}</td>
                        <td>{{ formatPaymentMethod(withdrawal.method) }}</td>
                        <td>
                          <span class="px-2 py-1 rounded-full text-xs font-medium"
                                [ngClass]="{
                                  'bg-green-500/20 text-green-400': withdrawal.status === 'approved',
                                  'bg-yellow-500/20 text-yellow-400': withdrawal.status === 'pending',
                                  'bg-red-500/20 text-red-400': withdrawal.status === 'rejected'
                                }">
                            {{ formatWithdrawalStatus(withdrawal.status) }}
                          </span>
                        </td>
                        <td class="text-white/70">{{ withdrawal.details }}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              
              <!-- No Results Message -->
              <div *ngIf="filteredWithdrawals.length === 0" class="text-center py-8 text-white/50">
                <p>No withdrawal requests found matching your criteria</p>
              </div>
            </div>
          </section>
          
          <!-- User Management Section -->
          <section *ngIf="activeSection === 'users'" class="mb-8">
            <div class="bg-black/50 backdrop-blur-lg rounded-xl p-6 border border-purple-500/30 shadow-neon">
              <h2 class="text-xl font-bold mb-6 flex items-center gap-2 text-purple-300">
                <lucide-icon name="users" [size]="20"></lucide-icon>
                User Management
              </h2>
              
              <!-- Search and Filter -->
              <div class="flex flex-col sm:flex-row gap-4 mb-6">
                <div class="relative flex-1">
                  <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <lucide-icon name="search" [size]="18" class="text-purple-500/50"></lucide-icon>
                  </div>
                  <input 
                    type="text" 
                    [(ngModel)]="userSearch"
                    (input)="filterUsers()"
                    class="w-full bg-black/50 border border-purple-500/30 rounded-md p-2 pl-10 text-white focus:outline-none focus:ring-2 focus:ring-purple-500/50"
                    placeholder="Search by username"
                  />
                </div>
                <select 
                  [(ngModel)]="userStatusFilter"
                  (change)="filterUsers()"
                  class="bg-black/50 border border-purple-500/30 rounded-md p-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500/50"
                >
                  <option value="all">All Statuses</option>
                  <option value="active">Active</option>
                  <option value="suspended">Suspended</option>
                  <option value="blocked">Blocked</option>
                </select>
              </div>
              
              <!-- Users List -->
              <div class="space-y-4">
                <!-- Loading State -->
                <div *ngIf="isLoading" class="flex justify-center items-center py-8">
                  <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"></div>
                </div>

                <!-- Users List -->
                <div *ngIf="!isLoading && filteredUsers.length > 0">
                  <div *ngFor="let user of filteredUsers" class="bg-black/30 rounded-lg p-4 border border-purple-500/10">
                    <div class="flex flex-col sm:flex-row justify-between gap-4">
                      <div class="flex-1">
                        <!-- User Header -->
                        <div class="flex items-center gap-3 mb-3">
                          <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center shadow-lg">
                            <span class="text-white font-medium text-lg">{{ user.username.charAt(0).toUpperCase() }}</span>
                          </div>
                          <div class="flex flex-col">
                            <div class="flex items-center gap-2">
                              <span class="font-medium text-white text-lg">{{ user.username }}</span>
                              <span class="px-3 py-1 rounded-full text-xs font-semibold flex items-center gap-1.5"
                                    [ngClass]="{
                                      'bg-green-500/20 border border-green-500/30': user.status === 'active',
                                      'bg-yellow-500/20 border border-yellow-500/30': user.status === 'suspended',
                                      'bg-red-500/20 border border-red-500/30': user.status === 'blocked'
                                    }">
                                <span class="w-1.5 h-1.5 rounded-full"
                                      [ngClass]="{
                                        'bg-green-400 animate-pulse': user.status === 'active',
                                        'bg-yellow-400': user.status === 'suspended',
                                        'bg-red-400': user.status === 'blocked'
                                      }"></span>
                                <span [ngClass]="{
                                  'text-green-400': user.status === 'active',
                                  'text-red-400': user.status === 'blocked' || user.status === 'suspended'
                                }">{{ formatUserStatus(user.status) }}</span>
                              </span>
                            </div>
                            <span class="text-sm text-white/50">ID: {{ user.id }}</span>
                          </div>
                        </div>

                        <!-- User Stats -->
                        <div class="grid grid-cols-2 sm:grid-cols-3 gap-4 mb-4">
                          <div class="bg-black/20 rounded-lg p-3 border border-purple-500/10">
                            <p class="text-sm text-purple-300">Balance</p>
                            <p class="font-medium text-lg">₹{{ user.balance.toLocaleString() }}</p>
                          </div>
                          <div class="bg-black/20 rounded-lg p-3 border border-purple-500/10">
                            <p class="text-sm text-purple-300">Total Games</p>
                            <p class="font-medium text-lg">{{ (user.stats?.totalGames || 0).toLocaleString() }}</p>
                          </div>
                          <div class="bg-black/20 rounded-lg p-3 border border-purple-500/10">
                            <p class="text-sm text-purple-300">Profit/Loss</p>
                            <p class="font-medium text-lg" [ngClass]="(user.stats?.profitLoss || 0) >= 0 ? 'text-green-400' : 'text-red-400'">
                              {{ (user.stats?.profitLoss || 0) >= 0 ? '+' : '-' }}₹{{ Math.abs(user.stats?.profitLoss || 0).toLocaleString() }}
                            </p>
                          </div>
                        </div>

                        <!-- User Details -->
                        <div class="text-sm text-white/70 space-y-1.5">
                          <p class="flex items-center gap-2">
                            <span class="text-purple-300">Member since:</span>
                            {{ formatDate(user.createdAt) }}
                          </p>
                          <ng-container *ngIf="user.stats && user.stats.lastActive; else noLastActive">
                            <p class="flex items-center gap-2">
                              <span class="text-purple-300">Last active:</span>
                              {{ formatDateTime(user.stats.lastActive) }}
                            </p>
                          </ng-container>
                          <ng-template #noLastActive>
                            <p class="flex items-center gap-2">
                              <span class="text-purple-300">Last active:</span>
                              <span>Not available</span>
                            </p>
                          </ng-template>
                        </div>
                      </div>

                      <!-- Action Buttons -->
                      <div class="flex gap-2 sm:self-center">
                        <app-button
                          *ngIf="user.status !== 'active'"
                          (onClick)="updateUserStatus(user.id, 'active')"
                          className="bg-green-500/20 hover:bg-green-500/30 text-green-300 border border-green-400/30 transition-all duration-200 hover:scale-105"
                          fontSize="0.75rem"
                          padding="0.375rem 0.75rem"
                        >
                          <lucide-icon name="user-check" [size]="14" class="mr-1"></lucide-icon> Activate
                        </app-button>
                        <app-button
                          *ngIf="user.status !== 'suspended'"
                          (onClick)="updateUserStatus(user.id, 'suspended')"
                          className="bg-yellow-500/20 hover:bg-yellow-500/30 text-yellow-300 border border-yellow-400/30 transition-all duration-200 hover:scale-105"
                          fontSize="0.75rem"
                          padding="0.375rem 0.75rem"
                        >
                          <lucide-icon name="alert-triangle" [size]="14" class="mr-1"></lucide-icon> Suspend
                        </app-button>
                        <app-button
                          *ngIf="user.status !== 'blocked'"
                          (onClick)="updateUserStatus(user.id, 'blocked')"
                          className="bg-red-500/20 hover:bg-red-500/30 text-red-300 border border-red-400/30 transition-all duration-200 hover:scale-105"
                          fontSize="0.75rem"
                          padding="0.375rem 0.75rem"
                        >
                          <lucide-icon name="ban" [size]="14" class="mr-1"></lucide-icon> Block
                        </app-button>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- No Results Message -->
                <div *ngIf="!isLoading && filteredUsers.length === 0" class="text-center py-8 text-white/50">
                  <p>No users found matching your criteria</p>
                </div>
              </div>
            </div>
          </section>
        </div>
      </div>
    </div>
  </div>